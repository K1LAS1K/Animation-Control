-- Enhanced Animation Control GUI
-- By KILASIK

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer

-- Color Palette
local ColorPalette = {
    primary_dark = Color3.fromRGB(40, 40, 40),
    secondary_dark = Color3.fromRGB(50, 50, 50),
    button_inactive = Color3.fromRGB(60, 60, 60),
    button_active = Color3.fromRGB(80, 80, 80),
    button_hover = Color3.fromRGB(70, 70, 70),
    text_primary = Color3.fromRGB(255, 255, 255),
    success = Color3.fromRGB(0, 200, 0),
    error = Color3.fromRGB(200, 0, 0),
    warning = Color3.fromRGB(200, 200, 0),
    discord = Color3.fromRGB(88, 101, 242),
    accent = Color3.fromRGB(100, 100, 100)
}

-- Variables
local selectedPlayer = nil
local selectedPosition = "Front"
local animationPlaying = false
local animationTrack = nil
local followConnection = nil
local playerDropdownOpen = false
local positionDropdownOpen = false

-- Position options
local positionOptions = {
    {name = "Front", description = "In front of target", offset = Vector3.new(0, 0, -2)},
    {name = "Behind", description = "Behind target", offset = Vector3.new(0, 0, 2)},
    {name = "Left Side", description = "Left side of target", offset = Vector3.new(-2, 0, 0)},
    {name = "Right Side", description = "Right side of target", offset = Vector3.new(2, 0, 0)},
    {name = "Above", description = "Above target", offset = Vector3.new(0, 3, 0)},
    {name = "Same Position", description = "Exact same position", offset = Vector3.new(0, 0, 0)},
    {name = "Close Front", description = "Very close to front", offset = Vector3.new(0, 0, -0.5)},
    {name = "Close Behind", description = "Very close behind", offset = Vector3.new(0, 0, 0.5)},
    {name = "Diagonal Front-Left", description = "Front-left diagonal", offset = Vector3.new(-1.5, 0, -1.5)},
    {name = "Diagonal Front-Right", description = "Front-right diagonal", offset = Vector3.new(1.5, 0, -1.5)},
    {name = "Diagonal Back-Left", description = "Back-left diagonal", offset = Vector3.new(-1.5, 0, 1.5)},
    {name = "Diagonal Back-Right", description = "Back-right diagonal", offset = Vector3.new(1.5, 0, 1.5)}
}

-- GUI Creation
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "KILASIKAnimationGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 350, 0, 480)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -240)
mainFrame.BackgroundColor3 = ColorPalette.primary_dark
mainFrame.BorderSizePixel = 1
mainFrame.BorderColor3 = Color3.fromRGB(80, 80, 80)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.ZIndex = 1
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 8)
mainCorner.Parent = mainFrame

-- Header
local headerFrame = Instance.new("Frame")
headerFrame.Size = UDim2.new(1, 0, 0, 50)
headerFrame.Position = UDim2.new(0, 0, 0, 0)
headerFrame.BackgroundColor3 = ColorPalette.secondary_dark
headerFrame.BorderSizePixel = 0
headerFrame.Parent = mainFrame

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 8)
headerCorner.Parent = headerFrame

-- KILASIK Branding
local brandLabel = Instance.new("TextLabel")
brandLabel.Size = UDim2.new(1, -40, 0.6, 0)
brandLabel.Position = UDim2.new(0, 10, 0, 0)
brandLabel.BackgroundTransparency = 1
brandLabel.Text = "Animation Control - By KILASIK"
brandLabel.TextColor3 = ColorPalette.text_primary
brandLabel.Font = Enum.Font.GothamBold
brandLabel.TextSize = 14
brandLabel.TextXAlignment = Enum.TextXAlignment.Left
brandLabel.Parent = headerFrame

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 25, 0, 25)
closeButton.Position = UDim2.new(1, -30, 0, 12.5)
closeButton.BackgroundColor3 = ColorPalette.error
closeButton.Text = "X"
closeButton.TextColor3 = ColorPalette.text_primary
closeButton.Font = Enum.Font.Gotham
closeButton.TextSize = 12
closeButton.BorderSizePixel = 0
closeButton.Parent = headerFrame

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 4)
closeCorner.Parent = closeButton

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -20, 1, -110)
contentFrame.Position = UDim2.new(0, 10, 0, 60)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Player Selection Label
local playerLabel = Instance.new("TextLabel")
playerLabel.Size = UDim2.new(1, 0, 0, 25)
playerLabel.Position = UDim2.new(0, 0, 0, 10)
playerLabel.BackgroundTransparency = 1
playerLabel.Text = "Select Target Player:"
playerLabel.TextColor3 = ColorPalette.text_primary
playerLabel.Font = Enum.Font.Gotham
playerLabel.TextSize = 12
playerLabel.TextXAlignment = Enum.TextXAlignment.Left
playerLabel.Parent = contentFrame

-- Player Dropdown
local playerDropdown = Instance.new("TextButton")
playerDropdown.Size = UDim2.new(1, 0, 0, 30)
playerDropdown.Position = UDim2.new(0, 0, 0, 40)
playerDropdown.BackgroundColor3 = ColorPalette.secondary_dark
playerDropdown.Text = "Select a player..."
playerDropdown.TextColor3 = ColorPalette.text_primary
playerDropdown.Font = Enum.Font.Gotham
playerDropdown.TextSize = 12
playerDropdown.BorderSizePixel = 0
playerDropdown.Parent = contentFrame

local playerDropdownCorner = Instance.new("UICorner")
playerDropdownCorner.CornerRadius = UDim.new(0, 4)
playerDropdownCorner.Parent = playerDropdown

-- Player Dropdown Arrow
local playerArrow = Instance.new("TextLabel")
playerArrow.Size = UDim2.new(0, 20, 1, 0)
playerArrow.Position = UDim2.new(1, -25, 0, 0)
playerArrow.BackgroundTransparency = 1
playerArrow.Text = "▼"
playerArrow.TextColor3 = ColorPalette.text_primary
playerArrow.Font = Enum.Font.Gotham
playerArrow.TextSize = 10
playerArrow.Parent = playerDropdown

-- Player List Frame
local playerListFrame = Instance.new("ScrollingFrame")
playerListFrame.Size = UDim2.new(1, 0, 0, 120)
playerListFrame.Position = UDim2.new(0, 0, 0, 75)
playerListFrame.BackgroundColor3 = ColorPalette.accent
playerListFrame.BorderSizePixel = 1
playerListFrame.BorderColor3 = Color3.fromRGB(80, 80, 80)
playerListFrame.ScrollBarThickness = 4
playerListFrame.Visible = false
playerListFrame.ZIndex = 10
playerListFrame.Parent = screenGui

local playerListCorner = Instance.new("UICorner")
playerListCorner.CornerRadius = UDim.new(0, 4)
playerListCorner.Parent = playerListFrame

local playerListLayout = Instance.new("UIListLayout")
playerListLayout.SortOrder = Enum.SortOrder.Name
playerListLayout.Padding = UDim.new(0, 2)
playerListLayout.Parent = playerListFrame

-- Position Selection Label
local positionLabel = Instance.new("TextLabel")
positionLabel.Size = UDim2.new(1, 0, 0, 25)
positionLabel.Position = UDim2.new(0, 0, 0, 85)
positionLabel.BackgroundTransparency = 1
positionLabel.Text = "Select Position Relative to Target:"
positionLabel.TextColor3 = ColorPalette.text_primary
positionLabel.Font = Enum.Font.Gotham
positionLabel.TextSize = 12
positionLabel.TextXAlignment = Enum.TextXAlignment.Left
positionLabel.Parent = contentFrame

-- Position Dropdown
local positionDropdown = Instance.new("TextButton")
positionDropdown.Size = UDim2.new(1, 0, 0, 30)
positionDropdown.Position = UDim2.new(0, 0, 0, 115)
positionDropdown.BackgroundColor3 = ColorPalette.secondary_dark
positionDropdown.Text = "Front - In front of target"
positionDropdown.TextColor3 = ColorPalette.text_primary
positionDropdown.Font = Enum.Font.Gotham
positionDropdown.TextSize = 12
positionDropdown.BorderSizePixel = 0
positionDropdown.Parent = contentFrame

local positionDropdownCorner = Instance.new("UICorner")
positionDropdownCorner.CornerRadius = UDim.new(0, 4)
positionDropdownCorner.Parent = positionDropdown

-- Position Dropdown Arrow
local positionArrow = Instance.new("TextLabel")
positionArrow.Size = UDim2.new(0, 20, 1, 0)
positionArrow.Position = UDim2.new(1, -25, 0, 0)
positionArrow.BackgroundTransparency = 1
positionArrow.Text = "▼"
positionArrow.TextColor3 = ColorPalette.text_primary
positionArrow.Font = Enum.Font.Gotham
positionArrow.TextSize = 10
positionArrow.Parent = positionDropdown

-- Position List Frame
local positionListFrame = Instance.new("ScrollingFrame")
positionListFrame.Size = UDim2.new(1, 0, 0, 150)
positionListFrame.Position = UDim2.new(0, 0, 0, 225)
positionListFrame.BackgroundColor3 = ColorPalette.accent
positionListFrame.BorderSizePixel = 1
positionListFrame.BorderColor3 = Color3.fromRGB(80, 80, 80)
positionListFrame.ScrollBarThickness = 4
positionListFrame.Visible = false
positionListFrame.ZIndex = 10
positionListFrame.Parent = screenGui

local positionListCorner = Instance.new("UICorner")
positionListCorner.CornerRadius = UDim.new(0, 4)
positionListCorner.Parent = positionListFrame

local positionListLayout = Instance.new("UIListLayout")
positionListLayout.SortOrder = Enum.SortOrder.LayoutOrder
positionListLayout.Padding = UDim.new(0, 2)
positionListLayout.Parent = positionListFrame

-- Animation ID Label
local animLabel = Instance.new("TextLabel")
animLabel.Size = UDim2.new(1, 0, 0, 25)
animLabel.Position = UDim2.new(0, 0, 0, 160)
animLabel.BackgroundTransparency = 1
animLabel.Text = "Animation ID:"
animLabel.TextColor3 = ColorPalette.text_primary
animLabel.Font = Enum.Font.Gotham
animLabel.TextSize = 12
animLabel.TextXAlignment = Enum.TextXAlignment.Left
animLabel.Parent = contentFrame

-- Animation ID Input
local animInput = Instance.new("TextBox")
animInput.Size = UDim2.new(1, 0, 0, 30)
animInput.Position = UDim2.new(0, 0, 0, 190)
animInput.BackgroundColor3 = ColorPalette.secondary_dark
animInput.Text = ""
animInput.PlaceholderText = "Enter animation ID..."
animInput.TextColor3 = ColorPalette.text_primary
animInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
animInput.Font = Enum.Font.Gotham
animInput.TextSize = 12
animInput.BorderSizePixel = 0
animInput.Parent = contentFrame

local animInputCorner = Instance.new("UICorner")
animInputCorner.CornerRadius = UDim.new(0, 4)
animInputCorner.Parent = animInput

-- Speed Label
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(1, 0, 0, 25)
speedLabel.Position = UDim2.new(0, 0, 0, 235)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "Animation Speed:"
speedLabel.TextColor3 = ColorPalette.text_primary
speedLabel.Font = Enum.Font.Gotham
speedLabel.TextSize = 12
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = contentFrame

-- Speed Input
local speedInput = Instance.new("TextBox")
speedInput.Size = UDim2.new(1, 0, 0, 30)
speedInput.Position = UDim2.new(0, 0, 0, 265)
speedInput.BackgroundColor3 = ColorPalette.secondary_dark
speedInput.Text = "1.0"
speedInput.PlaceholderText = "Speed (1.0 = normal)"
speedInput.TextColor3 = ColorPalette.text_primary
speedInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
speedInput.Font = Enum.Font.Gotham
speedInput.TextSize = 12
speedInput.BorderSizePixel = 0
speedInput.Parent = contentFrame

local speedInputCorner = Instance.new("UICorner")
speedInputCorner.CornerRadius = UDim.new(0, 4)
speedInputCorner.Parent = speedInput

-- Control Buttons
local startButton = Instance.new("TextButton")
startButton.Size = UDim2.new(0.48, 0, 0, 35)
startButton.Position = UDim2.new(0, 0, 0, 310)
startButton.BackgroundColor3 = ColorPalette.success
startButton.Text = "Start Animation"
startButton.TextColor3 = ColorPalette.text_primary
startButton.Font = Enum.Font.GothamBold
startButton.TextSize = 12
startButton.BorderSizePixel = 0
startButton.Parent = contentFrame

local startCorner = Instance.new("UICorner")
startCorner.CornerRadius = UDim.new(0, 4)
startCorner.Parent = startButton

local stopButton = Instance.new("TextButton")
stopButton.Size = UDim2.new(0.48, 0, 0, 35)
stopButton.Position = UDim2.new(0.52, 0, 0, 310)
stopButton.BackgroundColor3 = ColorPalette.error
stopButton.Text = "Stop"
stopButton.TextColor3 = ColorPalette.text_primary
stopButton.Font = Enum.Font.GothamBold
stopButton.TextSize = 12
stopButton.BorderSizePixel = 0
stopButton.Parent = contentFrame

local stopCorner = Instance.new("UICorner")
stopCorner.CornerRadius = UDim.new(0, 4)
stopCorner.Parent = stopButton

-- Discord Frame
local discordFrame = Instance.new("TextButton")
discordFrame.Size = UDim2.new(1, -20, 0, 35)
discordFrame.Position = UDim2.new(0, 10, 1, -45)
discordFrame.BackgroundColor3 = ColorPalette.discord
discordFrame.BorderSizePixel = 0
discordFrame.Text = "Discord: https://discord.gg/PHxN8nadgk"
discordFrame.TextColor3 = ColorPalette.text_primary
discordFrame.Font = Enum.Font.Gotham
discordFrame.TextSize = 11
discordFrame.Parent = mainFrame

local discordCorner = Instance.new("UICorner")
discordCorner.CornerRadius = UDim.new(0, 4)
discordCorner.Parent = discordFrame

-- Functions
local function updatePlayerList()
    for _, child in pairs(playerListFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end
    
    local players = Players:GetPlayers()
    playerListFrame.CanvasSize = UDim2.new(0, 0, 0, #players * 32)
    
    -- Update position relative to main frame
    local mainFramePos = mainFrame.AbsolutePosition
    local dropdownPos = playerDropdown.AbsolutePosition
    playerListFrame.Position = UDim2.new(0, dropdownPos.X, 0, dropdownPos.Y + 35)
    playerListFrame.Size = UDim2.new(0, playerDropdown.AbsoluteSize.X, 0, 120)
    
    for i, p in pairs(players) do
        if p ~= player then
            local playerButton = Instance.new("TextButton")
            playerButton.Size = UDim2.new(1, -8, 0, 30)
            playerButton.Position = UDim2.new(0, 4, 0, 0)
            playerButton.BackgroundColor3 = ColorPalette.button_inactive
            playerButton.Text = p.Name
            playerButton.TextColor3 = ColorPalette.text_primary
            playerButton.Font = Enum.Font.Gotham
            playerButton.TextSize = 11
            playerButton.BorderSizePixel = 0
            playerButton.ZIndex = 11
            playerButton.Parent = playerListFrame
            
            local buttonCorner = Instance.new("UICorner")
            buttonCorner.CornerRadius = UDim.new(0, 3)
            buttonCorner.Parent = playerButton
            
            playerButton.MouseButton1Click:Connect(function()
                selectedPlayer = p
                playerDropdown.Text = p.Name
                playerListFrame.Visible = false
                playerDropdownOpen = false
                playerArrow.Text = "▼"
            end)
            
            playerButton.MouseEnter:Connect(function()
                playerButton.BackgroundColor3 = ColorPalette.button_hover
            end)
            
            playerButton.MouseLeave:Connect(function()
                playerButton.BackgroundColor3 = ColorPalette.button_inactive
            end)
        end
    end
end

local function createPositionList()
    -- Update position relative to main frame
    local dropdownPos = positionDropdown.AbsolutePosition
    positionListFrame.Position = UDim2.new(0, dropdownPos.X, 0, dropdownPos.Y + 35)
    positionListFrame.Size = UDim2.new(0, positionDropdown.AbsoluteSize.X, 0, 150)
    
    for i, pos in pairs(positionOptions) do
        local posButton = Instance.new("TextButton")
        posButton.Size = UDim2.new(1, -8, 0, 30)
        posButton.Position = UDim2.new(0, 4, 0, 0)
        posButton.BackgroundColor3 = ColorPalette.button_inactive
        posButton.Text = pos.name .. " - " .. pos.description
        posButton.TextColor3 = ColorPalette.text_primary
        posButton.Font = Enum.Font.Gotham
        posButton.TextSize = 10
        posButton.BorderSizePixel = 0
        posButton.LayoutOrder = i
        posButton.ZIndex = 11
        posButton.Parent = positionListFrame
        
        local buttonCorner = Instance.new("UICorner")
        buttonCorner.CornerRadius = UDim.new(0, 3)
        buttonCorner.Parent = posButton
        
        posButton.MouseButton1Click:Connect(function()
            selectedPosition = pos.name
            positionDropdown.Text = pos.name .. " - " .. pos.description
            positionListFrame.Visible = false
            positionDropdownOpen = false
            positionArrow.Text = "▼"
        end)
        
        posButton.MouseEnter:Connect(function()
            posButton.BackgroundColor3 = ColorPalette.button_hover
        end)
        
        posButton.MouseLeave:Connect(function()
            posButton.BackgroundColor3 = ColorPalette.button_inactive
        end)
    end
    
    positionListFrame.CanvasSize = UDim2.new(0, 0, 0, #positionOptions * 32)
end

local function getPositionOffset(positionName)
    for _, pos in pairs(positionOptions) do
        if pos.name == positionName then
            return pos.offset
        end
    end
    return Vector3.new(0, 0, -2) -- Default to front
end

local function stopAnimation()
    if animationTrack then
        animationTrack:Stop()
        animationTrack = nil
    end
    
    if followConnection then
        followConnection:Disconnect()
        followConnection = nil
    end
    
    animationPlaying = false
    startButton.Text = "Start Animation"
    startButton.BackgroundColor3 = ColorPalette.success
end

local function startAnimation()
    if animationPlaying then
        stopAnimation()
        return
    end
    
    if not selectedPlayer then
        playerDropdown.Text = "Please select a player!"
        playerDropdown.TextColor3 = ColorPalette.error
        wait(2)
        playerDropdown.Text = "Select a player..."
        playerDropdown.TextColor3 = ColorPalette.text_primary
        return
    end
    
    local animationId = animInput.Text
    if animationId == "" then
        animInput.PlaceholderText = "Please enter animation ID!"
        animInput.PlaceholderColor3 = ColorPalette.error
        wait(2)
        animInput.PlaceholderText = "Enter animation ID..."
        animInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
        return
    end
    
    local speed = tonumber(speedInput.Text) or 1.0
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return end
    
    -- Create and play animation
    local animation = Instance.new("Animation")
    animation.AnimationId = "rbxassetid://" .. animationId
    
    local success, errorMsg = pcall(function()
        animationTrack = humanoid:LoadAnimation(animation)
        animationTrack:Play()
        animationTrack:AdjustSpeed(speed)
    end)
    
    if not success then
        animInput.Text = ""
        animInput.PlaceholderText = "Invalid animation ID!"
        animInput.PlaceholderColor3 = ColorPalette.error
        wait(2)
        animInput.PlaceholderText = "Enter animation ID..."
        animInput.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
        return
    end
    
    -- Start following target player
    local offset = getPositionOffset(selectedPosition)
    followConnection = RunService.Stepped:Connect(function()
        if selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") and 
           character and character:FindFirstChild("HumanoidRootPart") then
            local targetCFrame = selectedPlayer.Character.HumanoidRootPart.CFrame
            character.HumanoidRootPart.CFrame = targetCFrame * CFrame.new(offset)
        end
    end)
    
    animationPlaying = true
    startButton.Text = "Running..."
    startButton.BackgroundColor3 = ColorPalette.warning
end

-- Event Connections
playerDropdown.MouseButton1Click:Connect(function()
    playerDropdownOpen = not playerDropdownOpen
    playerListFrame.Visible = playerDropdownOpen
    playerArrow.Text = playerDropdownOpen and "▲" or "▼"
    if playerDropdownOpen then
        -- Update position when opening
        local dropdownPos = playerDropdown.AbsolutePosition
        playerListFrame.Position = UDim2.new(0, dropdownPos.X, 0, dropdownPos.Y + 35)
        playerListFrame.Size = UDim2.new(0, playerDropdown.AbsoluteSize.X, 0, 120)
        updatePlayerList()
        positionListFrame.Visible = false
        positionDropdownOpen = false
        positionArrow.Text = "▼"
    end
end)

positionDropdown.MouseButton1Click:Connect(function()
    positionDropdownOpen = not positionDropdownOpen
    positionListFrame.Visible = positionDropdownOpen
    positionArrow.Text = positionDropdownOpen and "▲" or "▼"
    if positionDropdownOpen then
        -- Update position when opening
        local dropdownPos = positionDropdown.AbsolutePosition
        positionListFrame.Position = UDim2.new(0, dropdownPos.X, 0, dropdownPos.Y + 35)
        positionListFrame.Size = UDim2.new(0, positionDropdown.AbsoluteSize.X, 0, 150)
        createPositionList()
        playerListFrame.Visible = false
        playerDropdownOpen = false
        playerArrow.Text = "▼"
    end
end)

startButton.MouseButton1Click:Connect(startAnimation)
stopButton.MouseButton1Click:Connect(stopAnimation)

discordFrame.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard("https://discord.gg/PHxN8nadgk")
        discordFrame.Text = "Discord link copied!"
        wait(2)
        discordFrame.Text = "Discord: https://discord.gg/PHxN8nadgk"
    else
        discordFrame.Text = "Click to join: discord.gg/PHxN8nadgk"
        wait(3)
        discordFrame.Text = "Discord: https://discord.gg/PHxN8nadgk"
    end
end)

closeButton.MouseButton1Click:Connect(function()
    stopAnimation()
    screenGui:Destroy()
end)

-- Hover effects
discordFrame.MouseEnter:Connect(function()
    discordFrame.BackgroundColor3 = Color3.fromRGB(114, 137, 218)
end)

discordFrame.MouseLeave:Connect(function()
    discordFrame.BackgroundColor3 = ColorPalette.discord
end)

-- Initialize
createPositionList()
updatePlayerList()

-- Update player list when players join/leave
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)

print("Enhanced Animation Control GUI by KILASIK loaded!")
